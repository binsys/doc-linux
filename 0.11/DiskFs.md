Linux 0.11 Install Disk Filesystem
================================================================================

准备过程
--------------------------------------------------------------------------------

#### 根据机器系统数据(DRIVE_INFO)设置硬盘参数(hd_info):

1. 硬盘参数表(DRIVE_INFO):

#define DRIVE_INFO (*(struct drive_info*)0x90080)  内存0x90080开始32字节的机器系统数据用于存放硬盘参数表.

2. 硬盘参数描述符:

所有硬盘的参数存放到类型为(struct hd_i_struct)的变量hd_info中

```
struct hd_i_struct {
    int head; // 磁头数
    int sect; // 每磁道扇区数
    int cyl;  // 柱面数
    int wpcom;
    int lzone;
    int ctl;
};
```

3. 硬盘信息描述符:

所有的硬盘信息存放到类型为(struct hd_struct)的变量hd中

```
static struct hd_struct {
    long start_sect;  // 起始扇区
    long nr_sects;    // 总扇区数
};
```

4. 过程:

设置硬盘参数信息是通过调用sys_setup来实现的,具体过程如下:

A. 根据硬盘参数表中的信息设置hd_info
B. 根据hd_info中的硬盘参数描述符中的信息设置hd

#### 读取硬盘引导块.

1. MINIX文件系统:

MINIX文件系统和UNIX文件系统基本相同,它由六个部分组成如下所示:
{引导块(1)}{超级块(1)}{i节点位图块(1)}{逻辑块位图(1)}{i节点(n)}{数据块(n)}

2. 引导块:

引导块是计算机加电启动时可由ROM BIOS自动读入的执行代码和数据.但并非所有盘都用于引导设备,所以对于
不用于引导的盘片,这一盘块可以不含代码,但任何盘片必须含有引导块空间.如果把内核映像文件存放在文件
系统中,那么就可以在文件系统所在设备的第一个块存放实际的引导程序，并由它来取得和加载文件系统中的
内核映像文件.

3. 过程:

读取硬盘引导块是通过在sys_setup中通过向bread函数传递硬盘设备号和块号0(引导块)来读取的,具体过程如下:

A. 调用getblk在缓冲区中申请一个空闲的缓冲块(struct buffer_head).
B. 进入getblk后首先调用get_hash_table查找hash表，检索此前是否有程序把现在要读的硬盘逻辑块
   (相同设备号和块号)已经读到缓冲区.使用hash表的目的是提高查询速度.
C. 进入get_hash_table后调用find_buffer查找缓冲区中是否有指定设备号,块号的缓冲块,如果能找到指定
   缓冲块，就直接用.

#### 从引导块中获取信息